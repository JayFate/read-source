# vite 中的函数解释

### invalidateTypeCache

`invalidateTypeCache` 是 Vite 构建工具中的一个方法，用于在开发过程中清除 TypeScript 类型缓存。当 TypeScript 类型发生变化时，Vite 会自动重新编译 TypeScript 代码并更新浏览器中的页面。但是，在某些情况下，可能需要手动清除 TypeScript 类型缓存，以便在浏览器中看到最新的类型定义。这时就可以使用 `invalidateTypeCache` 方法。

具体来说，`invalidateTypeCache` 方法会删除 Vite 中存储的 TypeScript 类型缓存，强制 Vite 在下一次编译时重新生成类型缓存。它可以接受一个参数，指定要清除缓存的文件路径。例如，如果要清除 `src/app.ts` 文件的类型缓存，可以使用以下代码：

```js
import { invalidateTypeCache } from "vite";

invalidateTypeCache("src/app.ts");
```

需要注意的是，`invalidateTypeCache` 方法只在开发过程中有用，在生产环境中不应该使用它。此外，由于 TypeScript 类型缓存的清除会影响编译性能，应该避免频繁调用该方法，只在必要时使用它。

### parseVueRequest

`parseVueRequest` 是 Vite 构建工具中的一个方法，用于解析 Vue 单文件组件的请求路径，提取其中的模块路径和查询参数。它通常用于构建插件开发，以便在构建过程中对 Vue 单文件组件进行处理。

具体来说，`parseVueRequest` 方法接受一个字符串参数，该参数是 Vue 单文件组件的请求路径，如 `/src/components/HelloWorld.vue?type=template`。它会将该字符串解析为一个对象，包含以下属性：

- `filename`: Vue 单文件组件的模块路径，如 `/src/components/HelloWorld.vue`。
- `query`: Vue 单文件组件的查询参数，以对象形式返回，如 `{ type: 'template' }`。

例如，下面的代码演示了如何使用 `parseVueRequest` 方法：

```js
import { parseVueRequest } from "vite";

const request = "/src/components/HelloWorld.vue?type=template";
const { filename, query } = parseVueRequest(request);

console.log(filename); // /src/components/HelloWorld.vue
console.log(query); // { type: 'template' }
```

需要注意的是，`parseVueRequest` 方法仅适用于 Vue 单文件组件的请求路径，对于其他类型的模块请求，可能需要使用其他方法进行解析。



### transformMain

`transformMain` 是 Vite 构建工具中的一个函数，用于将 Vue 单文件组件的主入口部分转换为 JavaScript 模块。它通常用于构建插件开发，以便在构建过程中对 Vue 单文件组件进行处理。

具体来说，`transformMain` 函数接受一个字符串参数，该参数是 Vue 单文件组件的主入口部分。它会将该字符串转换为一个 JavaScript 模块，该模块导出一个对象，包含以下属性：

- `render`: 一个函数，接受一个参数 `h`，该参数是 Vue 的渲染函数。在渲染函数中，可以使用 `h` 函数生成虚拟 DOM。
- `staticRenderFns`: 一个数组，包含一组静态渲染函数。这些函数在组件初始化时就会被编译成静态的 HTML 字符串，提高渲染性能。

例如，下面的代码演示了如何使用 `transformMain` 函数：



```js
import { transformMain } from 'vite';

const main = `
  export default {
    data() {
      return {
        name: 'world'
      }
    },
    render(h) {
      return h('div', null, 'Hello, ' + this.name + '!')
    }
  }
`;

const { code } = transformMain(main);

console.log(code);
// export default {
//   data() {
//     return {
//       name: 'world'
//     }
//   },
//   render: function(h) {
//     return h('div', null, 'Hello, ' + this.name + '!')
//   },
//   staticRenderFns: []
// }
```

需要注意的是，`transformMain` 函数只适用于 Vue 2.x 版本的单文件组件。对于 Vue 3.x 版本的单文件组件，可以使用 `@vue/compiler-sfc` 模块中的 `compileScript` 函数进行转换。



### transformTemplateAsModule

`transformTemplateAsModule` 是 Vite 构建工具中的一个函数，用于将 Vue 单文件组件的 template 模板转换为 JavaScript 模块。它通常用于构建插件开发，以便在构建过程中对 Vue 单文件组件进行处理。

具体来说，`transformTemplateAsModule` 函数接受一个字符串参数，该参数是 Vue 单文件组件的 template 模板。它会将该字符串转换为一个 JavaScript 模块，该模块导出一个函数，接受一个参数 `h`，该参数是 Vue 的渲染函数。在渲染函数中，可以使用 `h` 函数生成虚拟 DOM。

例如，下面的代码演示了如何使用 `transformTemplateAsModule` 函数：

```js
import { transformTemplateAsModule } from 'vite';

const template = '<div>Hello, {{ name }}!</div>';

const { code } = transformTemplateAsModule(template);

console.log(code);
// export default function render(_ctx, _cache) {
//   return (_cache[1] || (_cache[1] = h("div", null, "Hello, ", _ctx.name, "!")))
// }
```

需要注意的是，`transformTemplateAsModule` 函数只适用于 Vue 2.x 版本的单文件组件。对于 Vue 3.x 版本的单文件组件，可以使用 `@vue/compiler-sfc` 模块中的 `compileTemplate` 函数进行转换。

<!-- vite 中 transformMain 是做什么的 -->
